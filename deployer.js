const HDWalletProvider = require("@truffle/hdwallet-provider");
const Web3 = require("web3");

const ContractBuild = require("./build/contracts/CarSale.json");

const keys = require("./keys/keys.json")

const provider = new HDWalletProvider(keys.privKey, keys.providerUrl)

const web3 = new Web3(provider);

const byteCode = "0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061075c806100606000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c80632f16cd3414610051578063698aa65c146100bf5780637a10ca4d1461013b5780638da5cb5b1461019f575b600080fd5b6100a76004803603606081101561006757600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190803590602001909291905050506101d3565b60405180821515815260200191505060405180910390f35b610101600480360360208110156100d557600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506104e2565b604051808481526020018373ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390f35b6101876004803603604081101561015157600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919050505061052c565b60405180821515815260200191505060405180910390f35b6101a76106cf565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461022e57600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161415801561026b5750600083115b80156102775750600082115b61028057600080fd5b6000600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002015411156103b25761032082600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201546106f390919063ffffffff16565b600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002018190555082600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000181905550610481565b60405180606001604052808481526020018573ffffffffffffffffffffffffffffffffffffffff16815260200183815250600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550604082015181600201559050505b827fc0b4ae50615c6fc43d116cbf8e2d560ec97e5609515316ccdf76e0380c13014f8584604051808373ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a2600190509392505050565b60016020528060005260406000206000915090508060000154908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060020154905083565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461058757600080fd5b81600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020154116105d557600080fd5b61062a82600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206002015461070f90919063ffffffff16565b600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201819055507fefecab8ab8c9e99804b1fc5dbfcce98b40aac6195f1f671bacbb6988be723f628383604051808373ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a16001905092915050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008082840190508381101561070557fe5b8091505092915050565b60008282111561071b57fe5b81830390509291505056fea2646970667358221220269384bdd761b22896719c3111fa294ad93733d2f38b47e36038e6d26f49d65d64736f6c63430007040033";

const deploy = async () => {
    const accounts = await web3.eth.getAccounts();
    console.log("Attempting to deploy from account", accounts[0]);

    const balance = await web3.eth.getBalance(accounts[0]);
    console.log("balance is: ", balance);

    const result = await new web3.eth.Contract(ContractBuild.abi)
        .deploy({ data: byteCode })
        .send({ gas: '1000000', from: accounts[0] });
    console.log('Contract deployed to', result.options.address);

};

deploy();